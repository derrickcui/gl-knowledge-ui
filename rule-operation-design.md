目前 UI 已实现

业务概念条件（CONCEPT）
位置选择（正文/标题）
判断场景（Group：需全部满足，场景间任一满足）
Explain / Review / Checklist
UI 尚未开放（但后端已支持）

段落/句子位置限制（<PARAGRAPH>/<SENTENCE>）
ACCRUE/SUM/LOGSUM/PRODUCT 等评分逻辑
NEAR/PHRASE/ORDER 等 proximity 组合
TEXT/FIELD/TopicRef 的完整编辑器
Group 级 exclude / how.any / score.atLeast 等
所以：设计上“可扩展”，但当前交互只暴露了基础逻辑。
如果你要 UI 对齐后端的完整操作符，我可以按以下顺序把 UI 扩展出来：

Group 层：开放 ALL/ANY/EXCLUDE
Condition 扩展：TopicRef / Text / Field
Proximity 编辑器（NEAR/PHRASE/ORDER）
Score 编辑器（ACCRUE/SUM/LOGSUM/PRODUCT）
解释与 Review 对齐（Explain line + evidence）
你要我从哪一层开始扩展？

我要你列出每个实现后面都对应了什么，例如 concept，正文对应 <IN/content>，标题对应 <IN/title>，段落对应 <PARAGRAPH>，句子对应 <SENTENCE>，类似这样的总结

下面是“UI 选择 → 后端 GQL 生成”的一对一映射表（V1 冻结；字段名占位，发布时替换；{Topic} 保留）。

3. UI 能力 → GQL 操作符映射表（冻结）
3.1 已开放能力（v1）
UI 文案	GQL 映射
全部满足（规则）	<ALL>
任一满足（规则）	<ANY>
场景内：全部满足	<AND>
场景内：任一满足	<OR>
涉及业务概念	{Topic}
涉及某个主题（Topic）	{Topic}
出现在正文	<IN/content>
出现在标题	<IN/title>
排除该条件	<NOT>

3.2 Condition 属性（未开放，但语法已支持；非高级）
UI 能力	GQL 操作符
出现在同一段	<PARAGRAPH>
出现在同一句	<SENTENCE>

3.3 高级（逐步开放）
UI 能力	GQL 操作符
满足部分条件	<ACCRUE>
至少满足指定数量的条件	<LOGSUM/n>
按条件重要性综合判断	[weight] + <LOGSUM>

最终 UI → GQL 映射（封板确认）
UI 判断方式	是否配置数量	GQL
必须满足所有条件	否	<AND>(...)
满足任一条件	否	<OR>(...)
至少满足指定数量的条件	是	<LOGSUM/N>(...)
满足越多越容易成立	否	<ACCRUE>(...)

高级能力（页面现状文案）
目前有这么多高级能力：部分能力已开放，其它仍在研发中。
- 出现在文档正文中（默认）
- 出现在标题中（高级）
- 出现在同一段落中（高级）
- 出现在同一句话中（高级）
- 满足部分条件即可命中
- 至少满足指定数量的条件
- 按条件重要性综合判断
说明：不同条件的重要性不同，需要把它们按需求重新设计（权重策略与 UI 交互）。

⚠️ v1 不允许 UI 构造嵌套 Topic

八、Condition 条件卡片最终形态（v1）

这是目前规则编辑区最小的“语义单元”。
Group 只决定孩子之间的组合方式，所有概念、字段、排除都在 Condition 卡片里完成。

1) 卡片结构（固定布局）
```
┌───────────────────────────────────────────┐
│ 🧩 条件                                    │
│ ───────────────────────────────────────── │
│ 涉及业务概念：                             │
│   [ 中青年专业技术人才 ]                   │
│                                           │
│ 出现位置：                                 │
│   ● 文档正文  ○ 标题  ○ 同一段  ○ 同一句     │
│                                           │
│ 逻辑修饰：                                 │
│   ☐ 排除该条件                             │
│                                           │
│ 说明：                                     │
│   在文档正文中出现“中青年专业技术人才”     │
│                                           │
│                        [ 删除 ]            │
└───────────────────────────────────────────┘
```

2) 每个控件一一对应语义
* 概念选择 → TopicJNode ({conceptName})；UI 隐藏花括号，只展示名称。
* 位置选择 → `<IN/field>`；例如“正文”生成 `<IN/content> {concept}`，“标题”生成 `<IN/title> {concept}`。
* 排除复选框（☐ 排除该条件） → 对应 `<NOT>` 前缀，作用于当前 Condition node，不影响父 Group。
* 说明行（Explain line）根据逻辑组合（field + NOT + concept）生成自然语言。

3) 组合示例
```
判断场景（全部满足）：
- {中青年专业技术人才}                         // 文档正文
- <NOT> <IN/title> {电子材料}                   // 标题排除

GQL 等价：
<AND>(
  {中青年专业技术人才},
  <NOT> <IN/title> {电子材料}
)
```
重点：NOT 在 condition 内，Group 仍然只管 AND/OR（ALL/ANY）。

九、RuleNode v1 中的 NOT 建模

为了保持 AST 干净，Condition 节点通过一个标记字段表达排除，而不是新建一个 EXCLUDE Group。

* `RuleNode` 结构已经包含 `params?: Record<string, any>`，我们引入 `params?.negated?: boolean`（或 `params?.not?: true` 之类轻量 flag）。
* 每个 Condition 详细类型（CONCEPT_MATCH / TEXT_MATCH / FIELD_CONDITION / TOPIC_REF）持有 `params`：
  ```json
  {
    "type": "CONCEPT_MATCH",
    "params": {
      "conceptName": "中青年专业技术人才",
      "field": "DOC_TEXT",
      "negated": false
    }
  }
  ```
* `negated: true` 就表示编译后要在该节点前面补 `<NOT>`。编译器在生成 GQL 时首先检查 `negated`，如果为真就把子表达式包在 `<NOT>` 前缀里。
* Group/Scenario 仍通过 `params?.operator`（取 `ALL`/`ANY`）决定孩子组合，`NOT` 不再出现在这层。

这个建模方案不会改变现有 parsing/grammar，只是把 NOT 的语义下沉到 condition 层，对应 UI 里的“排除该条件”复选框。未来需要“排除整个组合”时，再在 Group 之外增加一个 `negated` 节点包装即可。
Topic / Rule 组合设计规范（v1）

- Topic 是最小可复用的语义单元
- Topic 内仅支持 AND / OR
- Topic 不感知 ALL / ANY / ACCRUE
- 规则层通过 ALL / ANY / ACCRUE 组合 Topic
- UI 不允许在 Topic 内创建 ALL / ANY
- UI 不允许在规则层直接创建 AND / OR

规则结构说明

每个「判断场景」代表一种成立路径，需要满足所有场景才成立。
规则逻辑：全部满足 / 任一满足，使用 ALL / ANY。
场景内条件：全部满足 / 任一满足，使用 AND / OR。


下面这张表你可以直接保存👇

UI 能力	是否已被 GQL 覆盖	对应操作符 / 结构
符合已有主题	✅ 已覆盖	{Topic}
出现在标题中	✅ 已覆盖	<IN/title>
出现在正文中	✅ 已覆盖	<IN/content>（默认）
出现在同一段中	✅ 已覆盖	<PARAGRAPH>(...)
出现在同一句中	✅ 已覆盖	<SENTENCE>(...)
AND / OR 组合	✅ 已覆盖	<AND> / <OR>
ALL / ANY 组合	✅ 已覆盖	<ALL> / <ANY>
NOT / 排除	✅ 已覆盖	<NOT>
满足部分条件即可	✅ 已覆盖	<ACCRUE>
至少满足指定数量的条件	✅ 已覆盖	<LOGSUM/n>
按条件重要性综合判断	✅ 已覆盖	[weight] + <LOGSUM> / <MULT>
模糊 / 拼写	✅ 已覆盖	<FUZZ> / <TYPO>
同义词	✅ 已覆盖	<THESAURUS>
自由文本	✅ 已覆盖	<FREETEXT>

👉 结论：语法能力 100% 覆盖 UI 规划能力，甚至远超。

3.2 Condition 属性（未开放，但语法已支持；非高级）UI 能力	GQL 操作符
出现在同一段	<PARAGRAPH>
出现在同一句	<SENTENCE>

3.3 高级（逐步开放）UI 能力	GQL 操作符
满足部分条件	<ACCRUE>
至少满足指定数量的条件	<LOGSUM/n>
按条件重要性综合判断	[weight] + <LOGSUM>

---

能力 #1：符合已有主题（产品级定义与交互规格）

一、业务语言定义（写入 PRD / 设计说明）
名称：符合已有主题
定义：当前规则是否命中一个已经定义好的主题规则；该主题由多个业务条件组成，并已通过审核与发布。
关键点：
- 这是“复用规则”，不是“再选一次条件”
- 不是复制粘贴
- 主题在 UI 上是“规则黑盒”

二、能力入口（唯一正确位置）
左侧 业务条件入口 → 基础条件 → 涉及某个主题（Topic）
开放后：由灰态不可点击 → 可点击入口
点击行为：不打开“业务概念弹窗”，而是进入“主题选择弹窗（Topic Picker）”

三、主题选择弹窗（Topic Picker）UI 设计
采用现有三栏弹窗结构，复用整体布局与交互骨架。

1) 弹窗标题与说明
标题：添加主题条件
副标题：选择一个已发布的主题，用于当前规则判断

2) 左栏：主题搜索与列表
- 搜索框：搜索主题名称 / 业务领域
- 主题卡片列表（只展示“已发布”主题）
- 每项信息：名称 + 状态 + 包含条件数
  示例：
  - 📘 人才补贴政策
    状态：已发布
    包含条件数：6
  - 📘 高新技术企业认定
    状态：已发布
    包含条件数：4
注意：
- 不显示规则细节
- 不显示逻辑结构
- 不展开主题内部条件

3) 中栏：已选主题（确认区）
已选主题：📘 人才补贴政策
说明文案：
该主题已定义并发布，包含多个业务条件。
当前规则将直接复用该主题的判断结果。

4) 右栏：主题匹配方式（唯一可配置点）
配置项一：主题命中范围（单选）
主题命中范围
● 整个文档（默认）
○ 指定位置（高级）

当选择“指定位置（高级）”时展开：
- 出现在标题中
- 出现在正文中
限制：不支持段 / 句（主题为宏规则，不支持细粒度位置）

配置项二：主题版本（只读）
主题版本：当前生效版本：v3（不可改、不可选）

5) 规则语义预览（复用现有预览组件）
示例：
当【文档正文】中 符合主题「人才补贴政策」时，该规则条件成立。

6) 操作按钮
[取消]    [添加到规则]

四、添加后在「判断场景」中的呈现
呈现为“主题条件块”，不拆解、不展开：
✔ 符合主题：人才补贴政策
  （已发布 · v3）

右侧操作：
- 编辑（仅可修改“命中范围”）
- 删除
禁止：
- 展开
- 查看内部条件

五、为什么这是“高级但安全”的
原则对照：
- 不暴露技术 ✅
- 不破坏原子性 ✅
- 不允许错误配置 ✅
- 可解释 ✅
- 支持复用 ✅
- 支持治理 ✅

六、GQL / AST 真实语义（用于校验）
UI 行为本质：把已发布 Topic 当作一个原子条件节点引用
- UI 不生成子 AST
- 仅生成 {TopicRef} 节点
- 版本固定
- 只控制作用范围

七、开放策略（必须同时定义）
默认策略：
- 主题状态 = 已发布
- 用户角色 >= 高级
满足上述条件方可点击入口；否则灰态并提示：
“需先发布主题后使用”
